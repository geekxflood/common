# AI Development Guidelines for Geekxflood Common

This file provides essential guidelines for AI assistants working on the Geekxflood Common project. These guidelines ensure consistency, quality, and adherence to project standards.

## Project Overview

The Geekxflood Common project is a collection of Go packages providing foundational functionality:

- **config**: Configuration management with CUE schema validation and hot reload
- **logging**: Structured logging with component isolation and context integration
- **ruler**: CUE expression evaluation with intelligent rule selection
- **snmptranslate**: MIB-based OID translation with caching and performance optimization
- **trapprocessor**: SNMP trap processing with template-based message formatting

## Core AI Assistant Instructions

### 1. Always Follow Project Standards

- **Quality Gates**: All code must pass `go fmt`, `golangci-lint`, `go test`, `go test -race`, `gosec`, `deadcode`
- **Test Coverage**: Maintain 80%+ coverage with comprehensive unit and integration tests
- **Documentation**: Follow standardized templates with ✅ checkmarks for features
- **Commit Messages**: Use conventional commits format (`type(scope): description`)

### 2. Code Implementation Approach

- **Study Existing Patterns**: Always examine current codebase patterns before implementing
- **Maintain Consistency**: Follow established conventions rather than introducing new ones
- **Interface-First Design**: Define interfaces in consuming packages, return interfaces from constructors
- **Error Handling**: Create package-specific error types, wrap with context, never ignore errors

### 3. Development Workflow

- **Branch Naming**: `feature/package-name-description`, `fix/package-name-issue`, `docs/description`
- **Small Changes**: Keep PRs focused and under 400 lines
- **Test-Driven**: Write tests alongside or before implementation
- **Documentation**: Update all relevant docs with code changes

### 4. Package-Specific Guidelines

#### Config Package
- Support both file-based and inline schema content
- Implement granular hot reload (schema and config independently)
- Handle environment variable substitution: `$VAR`, `${VAR}`, `${VAR:-default}`
- Use CUE for schema validation and type checking

#### Logging Package
- Build on Go's standard `log/slog` package
- Support component-aware logging with automatic context
- Provide both global and component-specific loggers
- Integrate seamlessly with Go's context package

#### Ruler Package
- Use CUE expressions for rule evaluation
- Support structured input/output specifications
- Optimize for high-performance scenarios (~8μs evaluation)
- Provide thread-safe concurrent evaluation

#### SNMP Packages (snmptranslate, trapprocessor)
- Implement efficient caching mechanisms
- Support MIB-based OID translation
- Handle SNMP trap processing with template formatting
- Optimize for high-throughput scenarios

## Quality Assurance Checklist

Before any code submission:

- [ ] **Formatting**: `go fmt ./...` applied
- [ ] **Linting**: `golangci-lint run --config .golangci.yml` passes
- [ ] **Testing**: `go test ./...` and `go test -race ./...` pass
- [ ] **Security**: `gosec -conf .gosec.json ./...` passes
- [ ] **Dead Code**: `deadcode -test ./...` passes
- [ ] **Documentation**: All relevant docs updated
- [ ] **Examples**: All code examples tested and working
- [ ] **Commit Message**: Follows conventional format

## Common Patterns and Standards

### Constructor Pattern
```go
// Return interfaces when possible
func NewManager(opts Options) (Manager, error) {
    return &manager{...}, nil
}
```

### Error Handling Pattern
```go
type ConfigError struct {
    Key     string
    Message string
    Cause   error
}

func (e ConfigError) Error() string {
    return fmt.Sprintf("config error for key %q: %s", e.Key, e.Message)
}

func (e ConfigError) Unwrap() error {
    return e.Cause
}
```

### Test Structure Pattern
```go
func TestFunction(t *testing.T) {
    tests := []struct {
        name     string
        input    string
        expected string
        wantErr  bool
    }{
        // Test cases...
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // Test implementation
        })
    }
}
```

## Documentation Template

```markdown
# Package `name`

Brief description (1-2 sentences, no marketing language).

## Key Features

✅ **Feature Name** - Brief description
✅ **Another Feature** - Brief description

## Installation

```bash
go get github.com/geekxflood/common/packagename
```

## Quick Start

```go
// Complete, runnable example
```

## API Reference

### Types and Functions
// Document all exported items
```

## Anti-Patterns to Avoid

### Code Anti-Patterns
- **Ignoring Errors**: Never use `_` to ignore errors
- **Global State**: Avoid global variables, use dependency injection
- **Large Functions**: Keep functions under 50 lines, prefer composition
- **Deep Nesting**: Use early returns to reduce nesting levels
- **Magic Numbers**: Use named constants for all numeric values

### Documentation Anti-Patterns
- **Marketing Language**: Avoid "production-grade", "enterprise-level", "world-class"
- **Outdated Examples**: Ensure all code examples match current API
- **Missing Context**: Always explain why, not just what
- **Inconsistent Formatting**: Follow the established template structure
- **Broken Links**: Verify all links work before committing

### Testing Anti-Patterns
- **Testing Implementation**: Test behavior, not internal implementation details
- **Shared State**: Each test should be independent and isolated
- **Complex Setup**: Use helper functions to simplify test setup
- **Missing Edge Cases**: Test both happy path and error conditions
- **Slow Tests**: Keep tests fast, use mocking for external dependencies

## Tools and Configuration

### Required Tools
- **golangci-lint**: Use project's `.golangci.yml` configuration (never modify)
- **gosec**: Security scanning with project's `.gosec.json` configuration
- **deadcode**: Dead code detection
- **go test**: Built-in testing with race detection

### CI/CD Integration
All quality checks are automated in the CI/CD pipeline and must pass before merging.

## Performance Characteristics

- **Config**: Sub-microsecond access after initial parsing and caching
- **Logging**: Minimal overhead structured logging with efficient field handling
- **Ruler**: ~8μs rule evaluation with smart pre-filtering and compilation
- **SNMP**: High-throughput trap processing with efficient OID translation

## AI Assistant Specific Instructions

When working on this project:

1. **Study Existing Patterns**: Always examine current codebase patterns before implementing
2. **Follow Established Conventions**: Use existing patterns rather than introducing new ones
3. **Test Thoroughly**: Include unit tests, integration tests, and working examples
4. **Document Comprehensively**: Update all relevant documentation with changes
5. **Validate Quality**: Ensure all quality gates pass before submission
6. **Ask for Clarification**: When project patterns are unclear, ask for guidance
7. **Suggest Improvements**: Identify opportunities for better practices
8. **Incremental Changes**: Make small, focused changes rather than large refactors
9. **Preserve Behavior**: Don't change existing behavior unless explicitly required
10. **Update Tests**: Ensure tests reflect any behavioral changes

## Recent Project Context

### Major Recent Changes
- **Granular Hot Reload**: Config package supports independent schema and config file watching
- **Environment Variables**: Added support for `$VAR`, `${VAR}`, and `${VAR:-default}` patterns
- **Inline Schemas**: Config package supports embedding CUE schemas directly in code
- **Component Logging**: Enhanced logging with component-aware loggers and context integration
- **Documentation Standardization**: All package docs follow consistent template structure
- **SNMP Integration**: Added comprehensive SNMP trap processing and OID translation

### Architecture Decisions
- **CUE Integration**: Heavy use of CUE for schema validation and expression evaluation
- **Standard Library First**: Prefer Go standard library over external dependencies
- **Interface-Based Design**: Return interfaces from constructors for flexibility
- **Context-Aware**: All long-running operations support context for cancellation
- **Thread-Safe by Design**: All public APIs are safe for concurrent use

Remember: These guidelines exist to maintain consistency and quality. When in doubt, follow the existing patterns in the codebase and ask for guidance on new approaches.

## Detailed Rule Files

For comprehensive details on specific aspects, refer to the rule files in `.augment/rules/`:

- **development-standards.md**: Detailed Go coding standards, package design, and testing practices
- **documentation-standards.md**: Comprehensive documentation templates and writing guidelines
- **project-workflow.md**: Complete workflow processes, quality assurance, and project management


